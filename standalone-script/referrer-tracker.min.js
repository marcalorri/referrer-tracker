!function(e){"use strict";const i={apiKey:"",licenseServer:"https://api.referrertracker.com/v1/validate",validateOnInit:!0,cacheValidation:!0,validationCacheDuration:864e5,cookiePrefix:"rt_",cookieExpireDays:30,cookiePath:"/",debug:!1,autoFillFields:!0,updateInterval:500,updateDuration:1e4};let t=!1,a=!1;const r=function(i){i=i.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");const t=new RegExp("[\\?&]"+i+"=([^&#]*)").exec(e.location.search);return null===t?"":decodeURIComponent(t[1].replace(/\+/g," "))},c=function(e){const i=e+"=",t=document.cookie.split(";");for(let e=0;e<t.length;e++){let a=t[e];for(;" "===a.charAt(0);)a=a.substring(1,a.length);if(0===a.indexOf(i))return decodeURIComponent(a.substring(i.length,a.length))}return""},o=function(e,i,t,a){const r=new Date;r.setTime(r.getTime()+24*t*60*60*1e3);const c=e+"="+encodeURIComponent(i)+";expires="+r.toUTCString()+";path="+a+";SameSite=Lax";document.cookie=c},n=function(e,i){document.cookie=e+"=;expires=Thu, 01 Jan 1970 00:00:00 GMT;path="+i},d=function(e,t){i.debug&&console.log("[ReferrerTracker] "+e,t||"")},s={getCachedValidation:function(){if(!i.cacheValidation)return null;try{const e=localStorage.getItem("rt_license_cache");if(!e)return null;const i=JSON.parse(e),t=Date.now();return i.expiresAt&&i.expiresAt>t?(d("Using cached license validation"),i):(localStorage.removeItem("rt_license_cache"),null)}catch(e){return d("Error reading license cache",e),null}},cacheValidation:function(e){if(i.cacheValidation)try{const t={...e,expiresAt:Date.now()+i.validationCacheDuration};localStorage.setItem("rt_license_cache",JSON.stringify(t)),d("License validation cached")}catch(e){d("Error caching license validation",e)}},validate:async function(){if(!i.apiKey||""===i.apiKey)return console.error("[ReferrerTracker] ERROR: API key is required. Get your key at https://referrertracker.com"),{valid:!1,error:"API key required"};const t=this.getCachedValidation();if(t)return t;d("Validating license with server...");try{const t=await fetch(i.licenseServer,{method:"POST",headers:{"Content-Type":"application/json","X-RT-Version":"1.0.0"},body:JSON.stringify({apiKey:i.apiKey,domain:e.location.hostname,url:e.location.href,userAgent:navigator.userAgent})});if(!t.ok)throw new Error("License validation failed: "+t.status);const a=await t.json();return a.valid?(d("License validated successfully",a),this.cacheValidation(a)):console.error("[ReferrerTracker] ERROR: Invalid license - "+(a.message||"Unknown error")),a}catch(e){console.error("[ReferrerTracker] ERROR: License validation failed",e);const i=this.getCachedValidation();return i?(d("Using cached license due to validation error"),i):{valid:!1,error:e.message}}},isValid:function(){return t}},l={searchEngines:{google:{domains:["google"],medium:"organic"},bing:{domains:["bing","msn"],medium:"organic"},yahoo:{domains:["yahoo"],medium:"organic"},duckduckgo:{domains:["duckduckgo"],medium:"organic"},yandex:{domains:["yandex"],medium:"organic"},baidu:{domains:["baidu"],medium:"organic"}},socialNetworks:{facebook:{domains:["facebook","fb.com"],medium:"social"},twitter:{domains:["twitter","x.com","t.co"],medium:"social"},instagram:{domains:["instagram"],medium:"social"},linkedin:{domains:["linkedin"],medium:"social"},pinterest:{domains:["pinterest"],medium:"social"},youtube:{domains:["youtube","youtu.be"],medium:"social"},reddit:{domains:["reddit"],medium:"social"},tiktok:{domains:["tiktok"],medium:"social"}},parse:function(i){const t={source:"direct",medium:"none",campaign:""};if(!i)return d("Empty referrer, using default values"),t;try{const a=new URL(i),r=a.hostname,c=e.location.hostname;if(d("Parsing referrer",{referrer:i,host:r,currentHost:c}),r===c){if(d('Referrer is from the same site, setting source to "direct" and medium to "none"'),a.search){const e=new URLSearchParams(a.search);e.has("utm_campaign")&&(t.campaign=e.get("utm_campaign"),d("Found utm_campaign in referrer URL",t.campaign))}return t}const o=new URLSearchParams(e.location.search);if(o.has("gclid"))return t.source="google",t.medium="cpc",o.has("utm_campaign")&&(t.campaign=o.get("utm_campaign")),d("Detected Google Ads traffic",t),t;if(o.has("fbclid"))return t.source="facebook",t.medium="cpc",o.has("utm_campaign")&&(t.campaign=o.get("utm_campaign")),d("Detected Facebook Ads traffic",t),t;if(o.has("msclkid"))return t.source="bing",t.medium="cpc",o.has("utm_campaign")&&(t.campaign=o.get("utm_campaign")),d("Detected Microsoft Ads traffic",t),t;if(o.has("ttclid")||o.has("ttclid_ss")||o.has("clickid"))return t.source="tiktok",t.medium="cpc",o.has("utm_campaign")&&(t.campaign=o.get("utm_campaign")),d("Detected TikTok Ads traffic",t),t;for(const[e,i]of Object.entries(this.searchEngines))for(const a of i.domains)if(r.includes(a))return t.source=e,t.medium=i.medium,d("Detected search engine",t),t;for(const[e,i]of Object.entries(this.socialNetworks))for(const a of i.domains)if(r.includes(a))return t.source=e,t.medium=i.medium,d("Detected social network",t),t;t.source=r,t.medium="referral",d("Generic referral traffic",t)}catch(e){d("Error parsing referrer URL",e)}return t}},u={init:async function(){if(d("Initializing Referrer Tracker"),i.validateOnInit&&!a){const e=await s.validate();if(t=!0===e.valid,a=!0,!t)return console.error("[ReferrerTracker] Tracking disabled: Invalid or missing license"),void console.error("[ReferrerTracker] Get your API key at: https://referrertracker.com");d("License validated - Tracking enabled")}this.setCookies(),i.autoFillFields&&this.autoFillFields()},setCookies:function(){const e=document.referrer||"";let t=r("utm_source"),a=r("utm_medium")||r("urm_medium"),s=r("utm_campaign"),u=r("gclid");u||(u=r("wbraid")),u||(u=r("gbraid")),u||(u=r("dclid"));let m=r("fbclid");m||(m=r("fb_click_id")),m||(m=r("fbadid"));let g=r("msclkid");g||(g=r("msclid"));let f=r("ttclid");if(f||(f=r("ttclid_ss")),f||(f=r("clickid")),d("URL Parameters",{source:t,medium:a,campaign:s,referrer:e,gclid:u,fbclid:m,msclkid:g,ttclid:f}),(!t||!a)&&e){const i=l.parse(e);t||(t=i.source),a||(a=i.medium),!s&&i.campaign&&(s=i.campaign)}t||(t="direct"),a||(a="none"),s||(s="none"),d("Final tracking values",{source:t,medium:a,campaign:s,referrer:e,gclid:u,fbclid:m,msclkid:g,ttclid:f});const p=c(i.cookiePrefix+"source");!(r("utm_source")||r("utm_medium")||r("utm_campaign"))&&p||(n(i.cookiePrefix+"source",i.cookiePath),n(i.cookiePrefix+"medium",i.cookiePath),n(i.cookiePrefix+"campaign",i.cookiePath),o(i.cookiePrefix+"source",t,i.cookieExpireDays,i.cookiePath),o(i.cookiePrefix+"medium",a,i.cookieExpireDays,i.cookiePath),o(i.cookiePrefix+"campaign",s,i.cookieExpireDays,i.cookiePath),d("Cookies updated"));!c(i.cookiePrefix+"referrer")&&e&&(o(i.cookiePrefix+"referrer",e,i.cookieExpireDays,i.cookiePath),d("Referrer cookie set",e)),u&&(o(i.cookiePrefix+"gclid",u,i.cookieExpireDays,i.cookiePath),d("GCLID cookie set",u)),m&&(o(i.cookiePrefix+"fbclid",m,i.cookieExpireDays,i.cookiePath),d("FBCLID cookie set",m)),g&&(o(i.cookiePrefix+"msclkid",g,i.cookieExpireDays,i.cookiePath),d("MSCLKID cookie set",g)),f&&(o(i.cookiePrefix+"ttclid",f,i.cookieExpireDays,i.cookiePath),d("TTCLID cookie set",f))},getTrackingValue:function(e){if("campaign"===e||"source"===e||"medium"===e){const i=r("utm_"+e);if(i)return i;if("medium"===e){const i=r("urm_"+e);if(i)return i}}if("gclid"===e){let e=r("gclid");if(e||(e=r("wbraid")),e||(e=r("gbraid")),e||(e=r("dclid")),e)return e}if("fbclid"===e){let e=r("fbclid");if(e||(e=r("fb_click_id")),e||(e=r("fbadid")),e)return e}if("msclkid"===e){let e=r("msclkid");if(e||(e=r("msclid")),e)return e}if("ttclid"===e){let e=r("ttclid");if(e||(e=r("ttclid_ss")),e||(e=r("clickid")),e)return e}const t=c(i.cookiePrefix+e);return t||("source"===e?"direct":"medium"===e||"campaign"===e?"none":"")},autoFillFields:function(){const e=this;this.updateFields(),setTimeout(function(){e.updateFields()},500);let t=0;const a=i.updateDuration/i.updateInterval,r=setInterval(function(){e.updateFields(),t++,t>=a&&(clearInterval(r),d("Stopped periodic field updates"))},i.updateInterval)},updateFields:function(){const e=this.getTrackingValue("source"),i=this.getTrackingValue("medium"),t=this.getTrackingValue("campaign"),a=this.getTrackingValue("referrer"),r=this.getTrackingValue("gclid"),c=this.getTrackingValue("fbclid"),o=this.getTrackingValue("msclkid"),n=this.getTrackingValue("ttclid");d("Updating fields",{source:e,medium:i,campaign:t,referrer:a,gclid:r,fbclid:c,msclkid:o,ttclid:n}),this.updateFieldsByClass("js-rt-source",e),this.updateFieldsByClass("js-rt-medium",i),this.updateFieldsByClass("js-rt-campaign",t),this.updateFieldsByClass("js-rt-referrer",a),this.updateFieldsByClass("js-rt-gclid",r),this.updateFieldsByClass("js-rt-fbclid",c),this.updateFieldsByClass("js-rt-msclkid",o),this.updateFieldsByClass("js-rt-ttclid",n),this.updateFieldById("rt-source",e),this.updateFieldById("rt-medium",i),this.updateFieldById("rt-campaign",t),this.updateFieldById("rt-referrer",a),this.updateFieldById("rt-gclid",r),this.updateFieldById("rt-fbclid",c),this.updateFieldById("rt-msclkid",o),this.updateFieldById("rt-ttclid",n),this.updateFieldsByName("rt_source",e),this.updateFieldsByName("rt_medium",i),this.updateFieldsByName("rt_campaign",t),this.updateFieldsByName("rt_referrer",a),this.updateFieldsByName("rt_gclid",r),this.updateFieldsByName("rt_fbclid",c),this.updateFieldsByName("rt_msclkid",o),this.updateFieldsByName("rt_ttclid",n)},updateFieldsByClass:function(e,i){const t=document.getElementsByClassName(e);for(let a=0;a<t.length;a++)t[a].value!==i&&(t[a].value=i,d("Updated field by class: "+e,i))},updateFieldById:function(e,i){const t=document.getElementById(e);t&&t.value!==i&&(t.value=i,d("Updated field by ID: "+e,i))},updateFieldsByName:function(e,i){const t=document.getElementsByName(e);for(let a=0;a<t.length;a++)t[a].value!==i&&(t[a].value=i,d("Updated field by name: "+e,i))}},m={getSource:function(){return!s.isValid()&&i.validateOnInit?(console.warn("[ReferrerTracker] License not validated"),""):u.getTrackingValue("source")},getMedium:function(){return u.getTrackingValue("medium")},getCampaign:function(){return u.getTrackingValue("campaign")},getReferrer:function(){return u.getTrackingValue("referrer")},getGclid:function(){return u.getTrackingValue("gclid")},getFbclid:function(){return u.getTrackingValue("fbclid")},getMsclkid:function(){return u.getTrackingValue("msclkid")},getTtclid:function(){return u.getTrackingValue("ttclid")},getAll:function(){return{source:this.getSource(),medium:this.getMedium(),campaign:this.getCampaign(),referrer:this.getReferrer(),gclid:this.getGclid(),fbclid:this.getFbclid(),msclkid:this.getMsclkid(),ttclid:this.getTtclid()}},configure:function(e){void 0!==e.apiKey&&(i.apiKey=e.apiKey),void 0!==e.licenseServer&&(i.licenseServer=e.licenseServer),void 0!==e.validateOnInit&&(i.validateOnInit=e.validateOnInit),void 0!==e.cacheValidation&&(i.cacheValidation=e.cacheValidation),void 0!==e.validationCacheDuration&&(i.validationCacheDuration=e.validationCacheDuration),void 0!==e.cookiePrefix&&(i.cookiePrefix=e.cookiePrefix),void 0!==e.cookieExpireDays&&(i.cookieExpireDays=e.cookieExpireDays),void 0!==e.cookiePath&&(i.cookiePath=e.cookiePath),void 0!==e.debug&&(i.debug=e.debug),void 0!==e.autoFillFields&&(i.autoFillFields=e.autoFillFields),void 0!==e.updateInterval&&(i.updateInterval=e.updateInterval),void 0!==e.updateDuration&&(i.updateDuration=e.updateDuration)},updateFields:function(){u.updateFields()},init:function(){u.init()}};"loading"===document.readyState?document.addEventListener("DOMContentLoaded",function(){u.init()}):u.init(),e.ReferrerTracker=m}(window);